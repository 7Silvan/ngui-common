!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("@angular/core"),require("@angular/common"),require("rxjs/internal/observable/fromEvent")):"function"==typeof define&&define.amd?define("@ngui/common",["exports","@angular/core","@angular/common","rxjs/internal/observable/fromEvent"],t):t((e.ngui=e.ngui||{},e.ngui.common={}),e.ng.core,e.ng.common,e.rxjs["internal/observable/fromEvent"])}(this,function(e,o,t,n){"use strict";var i=function(){function e(e,t,n){this.element=e,this.renderer=t,this.platformId=n,this.options={threshold:[.1,.2,.3,.4,.5,.6,.7,.8]},this.inview=new o.EventEmitter,this.notInview=new o.EventEmitter,this.isInview=!1,this.once80PctVisible=!1}return e.prototype.ngOnInit=function(){t.isPlatformBrowser(this.platformId)&&(this.observer=new IntersectionObserver(this.handleIntersect.bind(this),this.options),this.observer.observe(this.element.nativeElement))},e.prototype.ngOnDestroy=function(){this.observer.disconnect()},e.prototype.handleIntersect=function(e){var t=this;e.forEach(function(e){e.isIntersecting?(t.isInview=!0,t.defaultInviewHandler(e),t.inview.emit(e)):t.notInview.emit(e)})},e.prototype.defaultInviewHandler=function(e){if(!this.once80PctVisible&&!this.inview.observers.length)if(e.intersectionRatio<.8){var t=1.25*e.intersectionRatio,n="blur("+(20-4*Math.floor(10*e.intersectionRatio))+"px)";Object.assign(e.target.style,{opacity:t,filter:n})}else e.target.style.opacity=1,e.target.style.filter="unset",this.once80PctVisible=!0},e.decorators=[{type:o.Component,args:[{selector:"ngui-inview",template:'\n        <ng-container *ngIf="isInview" [ngTemplateOutlet]="template">\n        </ng-container>\n    ',styles:[":host {display: block;}"]}]}],e.ctorParameters=function(){return[{type:o.ElementRef},{type:o.Renderer2},{type:undefined,decorators:[{type:o.Inject,args:[o.PLATFORM_ID]}]}]},e.propDecorators={template:[{type:o.ContentChild,args:[o.TemplateRef]}],options:[{type:o.Input}],inview:[{type:o.Output}],notInview:[{type:o.Output}]},e}(),s=function(){function e(e,t,n){this.element=e,this.renderer=t,this.platformId=n,this.options={},this.nguiInview=new o.EventEmitter,this.nguiOutview=new o.EventEmitter}return e.prototype.ngOnInit=function(){t.isPlatformBrowser(this.platformId)&&(this.observer=new IntersectionObserver(this.handleIntersect.bind(this),this.options),this.observer.observe(this.element.nativeElement))},e.prototype.ngOnDestroy=function(){t.isPlatformBrowser(this.platformId)&&this.observer&&this.observer.disconnect()},e.prototype.handleIntersect=function(e){var t=this;e.forEach(function(e){e.isIntersecting?t.nguiInview.emit(e):t.nguiOutview.emit(e)})},e.decorators=[{type:o.Directive,args:[{selector:"[nguiInview], [nguiOutview]"}]}],e.ctorParameters=function(){return[{type:o.ElementRef},{type:o.Renderer2},{type:undefined,decorators:[{type:o.Inject,args:[o.PLATFORM_ID]}]}]},e.propDecorators={options:[{type:o.Input}],nguiInview:[{type:o.Output}],nguiOutview:[{type:o.Output}]},e}(),r=function(){function e(){}return e.decorators=[{type:o.NgModule,args:[{imports:[t.CommonModule],declarations:[i,s],exports:[i,s]}]}],e}(),a=function(e,t){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)};function p(e,t,n){var i;return void 0===n&&(n={}),"click"===t||t.match(/^mouse/)?i=new MouseEvent(t,n):t.match(/^key/)?i=new KeyboardEvent(t,n):t.match(/^touch/)&&(i=new TouchEvent(t,n)),e.dispatchEvent(i)}var c=function(){function e(e){this.factoryResolver=e}return e.prototype.createComponent=function(e,t){return this.rootViewContainer=t||this.rootViewContainer,this.factoryResolver.resolveComponentFactory(e).create(this.rootViewContainer.parentInjector)},e.prototype.insertComponent=function(e){var t="ngui-dyn-"+(Math.floor(Math.random()*Math.pow(10,7))+Math.pow(10,6));return e.location.nativeElement.setAttribute("id",t),e.instance.id=t,this.rootViewContainer.insert(e.hostView),e.instance},e.decorators=[{type:o.Injectable}],e.ctorParameters=function(){return[{type:undefined,decorators:[{type:o.Inject,args:[o.ComponentFactoryResolver]}]}]},e}(),u=function(){function e(e,t,n){this.element=e,this.renderer=t,this.cdRef=n,this.outView=!1,this.itemsBackup=[]}return e.prototype.restoreItems=function(){this.outView&&(this.outView=!1,this.items=Array.from(this.itemsBackup||[]),this.itemsBackup=undefined,this.renderer.setStyle(this.contentsEl,"height",undefined),this.cdRef.detectChanges())},e.prototype.ngOnInit=function(){this.contentsEl=this.element.nativeElement.querySelector(".inview-page.contents")},e.prototype.ngOnDestroy=function(){console.log("NguiInviewPageComponent.ngOnDestroy() is called"),this.destroyed=!0},e.prototype.emptyItems=function(){if(this.items&&this.contentsEl&&!this.outView){var e=this.element.nativeElement.getBoundingClientRect().height;this.renderer.setStyle(this.contentsEl,"height",e+"px"),this.outView=!0,this.itemsBackup=Array.from(this.items||[]),this.items=undefined,this.destroyed||this.cdRef.detectChanges()}},e.prototype.setItems=function(e){this.destroyed||(console.log("NguiInviewPageComponent.setItems() is called with",e),this.items=e,this.cdRef.detectChanges())},e.decorators=[{type:o.Component,args:[{selector:"ngui-inview-page",template:'\n    <div class="inview-page contents"\n      (nguiInview)="restoreItems()"\n      (nguiOutview)="emptyItems()">\n      \x3c!-- add blank ngui-list-item by condition  --\x3e\n      \x3c!-- no match found ngui-list-item by condition --\x3e\n      <ng-container\n        [ngTemplateOutlet]="template||defaultTemplate"\n        [ngTemplateOutletContext]="{items: items, outView: outView}">\n      </ng-container>\n      <div *ngIf="outView">{{ itemsBackup.length }} items hidden</div>\n    </div>\n\n    <ng-template #defaultTemplate>\n      <div *ngIf="!items"> Error: requires [items] </div>\n      <div *ngIf="!template"> Error: requires &lt;ng-template></div>\n    </ng-template>\n  ',styles:["\n    :host {display: block}\n  "]}]}],e.ctorParameters=function(){return[{type:o.ElementRef},{type:o.Renderer2},{type:o.ChangeDetectorRef}]},e.propDecorators={template:[{type:o.ContentChild,args:[o.TemplateRef]}],items:[{type:o.Input}]},e}(),l=function(){function e(e,t,n,i){this.renderer=e,this.element=t,this.dynamicComponentService=n,this.cdr=i,this.selected=new o.EventEmitter,this.escaped=new o.EventEmitter,this.bottomInview=new o.EventEmitter,this._focused=!1,this.inviewPages=[]}return e.prototype.ngAfterViewInit=function(){this.template&&this.bottomInview.observers.length||console.error("<ngui-virtual-list> requires [template] and {bottomInview)")},e.prototype.addAnInviewPageToPages=function(){this.isListLoading?console.log("Already a page being inserted, skipping adding a page"):(this.isListLoading=!0,this.inviewPage=this.dynamicComponentService.createComponent(u,this.pagesRef),this.dynamicComponentService.insertComponent(this.inviewPage),this.inviewPage.instance.template=this.template,this.inviewPages.push(this.inviewPage),this.bottomInview.emit(this))},e.prototype.addList=function(e){this.isListLoading=!1,console.log(">>>>>> NguiVirtualListComponent.addList() is called()"),this.inviewPage.instance.setItems(e)},e.decorators=[{type:o.Component,args:[{selector:"ngui-virtual-list",template:'\n    <div class="ngui-virtual-list"\n      (focus)="_focused = true"\n      (click)="_focused = true">\n      \x3c!-- hold multiple <ngui-inview-page> --\x3e\n      <div #pages></div>\n      \x3c!-- insert <ngui-inview-page> into #pages --\x3e\n      <ngui-inview (inview)="addAnInviewPageToPages()"></ngui-inview>\n    </div>\n  ',styles:["\n    :host {display: block}\n  "]}]}],e.ctorParameters=function(){return[{type:o.Renderer2},{type:o.ElementRef},{type:c},{type:o.ChangeDetectorRef}]},e.propDecorators={pagesRef:[{type:o.ViewChild,args:["pages",{read:o.ViewContainerRef}]}],template:[{type:o.ContentChild,args:[o.TemplateRef]}],selected:[{type:o.Output}],escaped:[{type:o.Output}],bottomInview:[{type:o.Output}]},e}(),h=function(){this.html="No Match Found"},d=function(){this.html="Select"},m=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.minInputChars=1,e.blankOption="Select One",e.noMatchItem="No Match Found",e._focused={input:!1,listItem:!1},e}return function(e,t){function n(){this.constructor=e}a(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}(e,t),Object.defineProperty(e.prototype,"isReady",{get:function(){var e=this._selectedFromList||this._escapedFromList,t=this._focused.input||this._focused.listItem,n=this.inputEl.value.length>=this.minInputChars;return!e&&t&&n},enumerable:!0,configurable:!0}),e.prototype.ngOnInit=function(){this.inputEl=document.querySelector("#"+this["for"]),this.positionThisUnderInputEl(),n.fromEvent(this.inputEl,"keyup").subscribe(this.onInputElKeyup.bind(this)),this.inputEl.addEventListener("focus",this.onInputElFocused.bind(this)),this.inputEl.addEventListener("blur",this.onInputElBlurred.bind(this)),this.selected.subscribe(this.onSelected.bind(this)),this.escaped.subscribe(this.onEscaped.bind(this))},e.prototype.onSelected=function(e){this._selectedFromList=!0,this.inputEl.focus(),this._lastSelected=e,this.cdr.detectChanges(),console.log("NguiAutoCompleteComponent.onSelected() is called",e)},e.prototype.onEscaped=function(){this._escapedFromList=!0,this.inputEl.focus(),this._lastSelected||(this.inputEl.value=this._orgInputValue),this.cdr.detectChanges(),console.log("NguiAutoCompleteComponent.onEscaped() is called")},e.prototype.onInputElFocused=function(e){console.log("NguiAutoCompleteComponent.onInputElFocused() is called",e),this.isListLoading=!1,"undefined"==typeof this._orgInputValue&&(this._orgInputValue=this.inputEl.value),this._prevInputValue=this.inputEl.value,this.setFocused("input",!0)},e.prototype.onInputElBlurred=function(){this.setFocused("input",!1)},e.prototype.clearList=function(){this.inviewPages.forEach(function(e){e.destroy()}),this.inviewPages=[]},e.prototype.onInputElKeyup=function(e){console.log("NguiAutoCompleteComponent.onInputKeyup() is called",e.key);var t=this.element.nativeElement.querySelector("ngui-list-item");"Enter"===e.key||"Escape"===e.key?t?p(t,"keyup",{key:e.key}):this.onEscaped():"ArrowDown"!==e.key&&"ArrowRight"!==e.key||!t?"ArrowUp"===e.key||"ArrowLeft"===e.key||this.inputEl.value.length>=this.minInputChars&&(this._selectedFromList=!1,this._escapedFromList=!1,this.addAutocompleteList()):t.focus()},e.prototype.addAutocompleteList=function(){var e=this;this.isReady&&(clearTimeout(this._acTimer),this._acTimer=setTimeout(function(){e.isListLoading=!1,e._prevInputValue=e.inputEl.value,e._escapedFromList=!1,e._selectedFromList=!1,e.clearList(),e.addAnInviewPageToPages()},200))},e.prototype.addMorePages=function(){this.inviewPages.length&&this.addAnInviewPageToPages()},e.prototype.setFocused=function(e,t){var n=this;t?(clearTimeout(this._focusTimer),this._focused={input:!1,listItem:!1},this._focused[e]=!0):this._focusTimer=setTimeout(function(){n._focused[e]=!1,n.cdr.detectChanges()},100)},e.prototype.positionThisUnderInputEl=function(){var e=this.element.nativeElement,t=this.inputEl.getBoundingClientRect(),n=t.top+t.height+window.scrollY;this.renderer.setStyle(e,"left",t.left+"px"),this.renderer.setStyle(e,"top",n+"px"),this.renderer.setStyle(e,"minWidth",t.width+"px")},e.prototype.addList=function(e){var t;console.log(">>>>>> NguiAutocompleteComponent.addList() is called()"),this.isListLoading=!1;var n={};1===this.inviewPages.length&&(!this.noMatchItem||e&&0!==e.length?this.blankOption&&((n=new d).html=this.blankOption):(t=new h,n.html=this.noMatchItem));var i=[].concat(t,n,e).filter(function(e){return e});this.inviewPage.instance.setItems(i),this.cdr.detectChanges()},e.decorators=[{type:o.Component,args:[{selector:"ngui-autocomplete",template:'\n    <div *ngIf="isReady" class="ngui-autocomplete">\n      <div #pages></div>\n      <ngui-inview (inview)="addMorePages()"></ngui-inview>\n    </div>\n  ',styles:["\n    :host {position: absolute; background-color: #fff; max-height: 300px; overflow: auto}\n    .ngui-autocomplete { border: 1px solid #ccc; padding: 4px }\n  "]}]}],e.propDecorators={"for":[{type:o.Input}],minInputChars:[{type:o.Input}],blankOption:[{type:o.Input}],noMatchItem:[{type:o.Input}],template:[{type:o.ContentChild,args:[o.TemplateRef]}]},e}(l),g=function(){function e(e){this.element=e,this.selected=new o.EventEmitter,this.escaped=new o.EventEmitter}return e.decorators=[{type:o.Directive,args:[{selector:"ngui-list"}]}],e.ctorParameters=function(){return[{type:o.ElementRef}]},e.propDecorators={selected:[{type:o.Output}],escaped:[{type:o.Output}]},e}(),f=function(){function e(e,t,n,i,o,s){this.el=e,this.renderer=t,this.viewContainer=n,this.listDirective=i,this.virtualListComponent=o,this.autocompleteComponent=s}return e.prototype.ngOnInit=function(){if(this.renderer.setAttribute(this.el.nativeElement,"tabindex","0"),this.parentListComp=this.listDirective||this.virtualListComponent||this.autocompleteComponent,!this.parentListComp)throw Error("ngui-list-item requires parent of ngui-list, ngui-virtual-list, or ngui-autocomplete.");(this.object instanceof d||this.object instanceof h)&&(this.viewContainer.clear(),this.el.nativeElement.innerHTML=this.object.html)},e.prototype.keydown=function(e){var t=this.el.nativeElement,n=e.which||e.keyCode,i=this.parentListComp.element.nativeElement,o=Array.from(i.querySelectorAll("ngui-list-item")),s=o.indexOf(t),r=o[s+1]||o[0],a=o[s-1]||o[o.length-1];switch(n){case 37:case 38:a.focus();break;case 39:case 40:r.focus()}},e.prototype.keyup=function(e){switch(e.key){case"Enter":this.parentListComp.selected.emit(this.object);break;case"Escape":this.parentListComp.escaped.emit()}},e.prototype.mousedown=function(){this.parentListComp.selected.emit(this.object)},e.prototype.focused=function(){this.parentListComp.setFocused&&this.parentListComp.setFocused("listItem",!0)},e.prototype.blurred=function(){this.parentListComp.setFocused&&this.parentListComp.setFocused("listItem",!1)},e.decorators=[{type:o.Directive,args:[{selector:"ngui-list-item"}]}],e.ctorParameters=function(){return[{type:o.ElementRef},{type:o.Renderer2},{type:o.ViewContainerRef},{type:g,decorators:[{type:o.Optional},{type:o.Host}]},{type:l,decorators:[{type:o.Optional},{type:o.Host}]},{type:m,decorators:[{type:o.Optional},{type:o.Host}]}]},e.propDecorators={object:[{type:o.Input,args:["item"]}],keydown:[{type:o.HostListener,args:["keydown",["$event"]]}],keyup:[{type:o.HostListener,args:["keyup",["$event"]]}],mousedown:[{type:o.HostListener,args:["click",["$event"]]}],focused:[{type:o.HostListener,args:["focus",["$event"]]}],blurred:[{type:o.HostListener,args:["blur",["$event"]]}]},e}(),y=function(){function e(){}return e.decorators=[{type:o.NgModule,args:[{imports:[t.CommonModule,r],declarations:[m,u,g,f,l],exports:[m,u,g,f,l],entryComponents:[u]}]}],e}(),v=function(){function e(){}return e.prototype.transform=function(e,t){var n=e;if(t){var i=new RegExp(t,"ig");n=e.replace(i,function(e){return'<span class="ngui-highlight">'+e+"</span>"})}return n},e.decorators=[{type:o.Pipe,args:[{name:"nguiHighlight"}]}],e}(),w=function(){function e(){}return e.toLog=function(e){return this.LOG_LEVELS[this.logLevel]<this.LOG_LEVELS[e]},e.setLogLevel=function(e){e=e.toUpperCase();var t=Object.keys(this.LOG_LEVELS);-1<t.indexOf(e)?(window&&window.sessionStorage&&window.sessionStorage.setItem("konsole.LOG_LEVEL",e),this.logLevel=e):console.error("Error, invalid logLevel, it must be one of "+t)},e.debug=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this.toLog("DEBUG")&&console.debug.apply(console,arguments)},e.log=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this.toLog("LOG")&&console.log.apply(console,arguments)},e.info=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this.toLog("INFO")&&console.info.apply(console,arguments)},e.warn=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this.toLog("WARN")&&console.warn.apply(console,arguments)},e.error=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this.toLog("ERROR")&&console.error.apply(console,arguments)},e.LOG_LEVELS={ALL:parseInt("00000",2),DEBUG:parseInt("00001",2),LOG:parseInt("00010",2),INFO:parseInt("00100",2),WARN:parseInt("01000",2),ERROR:parseInt("10000",2),NONE:parseInt("11111",2)},e.logLevel="INFO",e}(),I=function(){function e(){}return e.decorators=[{type:o.NgModule,args:[{imports:[t.CommonModule],declarations:[v],exports:[v],providers:[c]}]}],e}(),E=function(){function e(){}return e.decorators=[{type:o.NgModule,args:[{imports:[r,y,I],exports:[r,y,I]}]}],e}();e.NguiCommonModule=E,e.NguiInviewModule=r,e.NguiInviewComponent=i,e.NguiInviewDirective=s,e.NguiListModule=y,e.NguiAutocompleteComponent=m,e.NguiListItemDirective=f,e.NguiListDirective=g,e.NguiInviewPageComponent=u,e.NguiVirtualListComponent=l,e.NguiUtilsModule=I,e.konsole=w,e.fireEvent=p,e.DynamicComponentService=c,e.NguiHighlightPipe=v,Object.defineProperty(e,"__esModule",{value:!0})});
//# sourceMappingURL=ngui-common.umd.min.js.map